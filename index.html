<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="translucent" />
		<title>Småhusbyn Skötselplanering</title>

		<!-- Favicon and PWA Icons -->
		<link rel="icon" type="image/png" href="images/favicon.png" />
		<link rel="apple-touch-icon" href="images/favicon.png" />
		<meta name="theme-color" content="#4caf50" />

		<!-- MapLibre GL JS -->
		<script src="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js"></script>
		<link href="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css" rel="stylesheet" />

		<!-- Supabase -->
		<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

		<!-- Custom styles -->
		<link href="css/styles.css" rel="stylesheet" />
	</head>
	<body>
		<div class="container">
			<!-- Map container -->
			<div id="map"></div>

			<!-- Sidebar for task details -->
			<div id="sidebar" class="sidebar hidden">
				<div class="sidebar-header">
					<h2 id="location-title">Location Details</h2>
					<button id="close-sidebar" class="close-button" aria-label="Close">&times;</button>
				</div>
				<div class="sidebar-content">
					<div id="location-details">
						<div id="location-info"></div>
						<div class="task-filter-tabs">
							<button class="tab-button active" data-filter="active">Active</button>
							<button class="tab-button" data-filter="upcoming">Later</button>
							<button class="tab-button" data-filter="history">History</button>
						</div>
						<div id="tasks-list"></div>

						<div class="add-task-section">
							<button id="add-task-btn" class="button add-task-button">+ Add New Task</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Add Location Sheet -->
		<div id="location-sheet" class="location-sheet hidden">
			<div class="sheet-header">
				<div>
					<h2>Add New Location</h2>
				</div>
				<button id="close-location-sheet" class="close-button" aria-label="Close">&times;</button>
			</div>
			<div class="sheet-content">
				<form id="add-location-form">
					<div class="form-group">
						<label for="location-name">Location Name</label>
						<input type="text" id="location-name" required autocomplete="off" />
					</div>

					<div class="form-group">
						<label>Coordinates</label>
						<div class="coordinates-display">
							<span id="selected-coordinates">Tap anywhere on the map to set the location</span>
						</div>
					</div>

					<div class="form-group">
						<label for="location-info">Location Information</label>
						<textarea
							id="location-info"
							required
							rows="6"
							placeholder="Enter information about this location.&#10;&#10;You can use:&#10;**bold text**&#10;![Image description](image-url)&#10;&#10;Line breaks will be preserved."
						></textarea>
					</div>

					<div class="form-actions">
						<button type="submit" class="button">Save Location</button>
						<button type="button" class="button button-secondary" id="cancel-location">Cancel</button>
					</div>
				</form>
			</div>
			<div class="safe-area-bottom"></div>
		</div>

		<!-- Add Task Sheet -->
		<div id="task-sheet" class="task-sheet hidden">
			<div class="sheet-header">
				<div>
					<h2>Add New Task</h2>
				</div>
				<button id="close-task-sheet" class="close-button" aria-label="Close">&times;</button>
			</div>
			<div class="sheet-content">
				<form id="add-task-form">
					<div class="form-group">
						<label for="task-info">Task Information</label>
						<textarea id="task-info" placeholder="Enter task info (first line will be the title)" required rows="4"></textarea>
					</div>
					<div class="form-group">
						<label for="task-start-date">Start Date:</label>
						<input type="date" id="task-start-date" />
					</div>
					<div class="form-group">
						<label>Task Duration:</label>
						<div class="radio-group">
							<label class="radio-label">
								<input type="radio" name="task-duration" value="week" checked />
								<span>Due in a week</span>
							</label>
							<label class="radio-label">
								<input type="radio" name="task-duration" value="month" />
								<span>Due in a month</span>
							</label>
							<label class="radio-label">
								<input type="radio" name="task-duration" value="season" />
								<span>Due in the season</span>
							</label>
						</div>
						<small id="completion-date-preview" class="completion-preview">Due date will be calculated based on start date</small>
					</div>
					<div class="form-actions">
						<button type="submit" class="button">Add Task</button>
						<button type="button" class="button button-secondary" id="cancel-task">Cancel</button>
					</div>
				</form>
			</div>
			<div class="safe-area-bottom"></div>
		</div>

		<!-- Edit Task Sheet -->
		<div id="edit-task-sheet" class="task-sheet hidden">
			<div class="sheet-header">
				<div>
					<h2 id="edit-task-title">Edit Task</h2>
				</div>
				<button id="close-edit-task-sheet" class="close-button" aria-label="Close">&times;</button>
			</div>
			<div class="sheet-content">
				<div id="task-details">
					<h3 id="task-name">Task Name</h3>
					<p id="task-description">Task description...</p>
					<div class="task-info">
						<p><strong>Start Date:</strong> <span id="task-start-date-display"></span></p>
						<p><strong>Status:</strong> <span id="task-status-display"></span></p>
						<p><strong>Tries:</strong> <span id="task-tries-display"></span></p>
					</div>
				</div>
				<div class="form-actions">
					<button type="button" class="button" id="complete-btn">Complete</button>
					<button type="button" class="button button-secondary" id="postpone-btn">Postpone</button>
					<button type="button" class="button button-tertiary" id="cancel-btn">Cancel</button>
				</div>
			</div>
			<div class="safe-area-bottom"></div>
		</div>

		<!-- Date Selection Sheet -->
		<div id="date-selection-sheet" class="task-sheet hidden">
			<div class="sheet-header">
				<div>
					<h2 id="date-selection-title">Select When to Start</h2>
				</div>
				<button id="close-date-selection-sheet" class="close-button" aria-label="Close">&times;</button>
			</div>
			<div class="sheet-content">
				<div id="date-options" class="date-options">
					<!-- Date options will be populated dynamically -->
				</div>
			</div>
			<div class="safe-area-bottom"></div>
		</div>

		<!-- Scripts -->
		<script src="js/config.js"></script>
		<script src="js/data.js"></script>
		<script src="js/app.js"></script>
	</body>
</html>
